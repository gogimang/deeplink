<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Deeplink URL Generator</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9fafc;
      margin: 0;
      padding: 2rem;
      color: #2c3e50;
    }

    h2 {
      border-left: 4px solid #3498db;
      padding-left: 0.5rem;
      font-size: 1.2rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background: #fff;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 0.5rem;
    }

    th {
      background: #ecf0f1;
    }

    input, select {
      padding: 0.4rem;
      width: 100%;
      box-sizing: border-box;
    }

    button {
      transition: all 0.2s ease;

      padding: 0.5rem 1rem;
      margin: 0.5rem 0.5rem 1rem 0;
      border: none;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
        background: #ecf0f1; /* 기본 버튼 배경색 추가 */
      color: #2c3e50; /* 기본 버튼 글자색 추가 */
  }

  button:hover {
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    transform: translateY(-1px);
      background: #3498db;
      color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* 파일 업로드 버튼 스타일 */
    .file-upload-button {
        display: inline-block; /* 라벨을 버튼처럼 표시 */
        transition: all 0.2s ease;
        padding: 0.5rem 1rem;
        margin: 0.5rem 0.5rem 1rem 0;
        border: none;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
        background: #ecf0f1; /* 기본 버튼 배경색 */
        color: #2c3e50; /* 기본 버튼 글자색 */
        text-align: center; /* 텍스트 중앙 정렬 */
    }

    .file-upload-button:hover {
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        transform: translateY(-1px);
        background: #3498db;
        color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* 실제 파일 입력 필드 숨기기 */
    #bannerFiles,
    #importTemplatesFile { /* Import 파일 입력 필드도 숨김 */
        display: none;
    }

    .output {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .card {
      display: flex;
      align-items: flex-start;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 6px;
      width: 100%;
      max-width: 720px;
      box-sizing: border-box;
      gap: 1rem;
    }

    .card img {
      width: 120px;
      height: auto;
      border-radius: 4px;
      flex-shrink: 0;
      object-fit: contain;
      background: #f0f0f0;
    }

    .card .info {
      flex-grow: 1;
    }

    .card table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    .card td {
      padding: 0.3rem;
      border: none;
      vertical-align: top;
    }

    .card code {
      display: block;
      margin-top: 0.5rem;
      background: #f4f4f4;
      padding: 0.3rem;
      font-size: 0.8rem;
      word-break: break-all;
      border-radius: 4px;
    }

    .card button {
      transition: all 0.2s ease;

      margin-top: 0.4rem;
      font-size: 0.8rem;
    }
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .card {
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 6px;
      width: calc(33% - 1rem);
      box-sizing: border-box;
    }

    .card img {
      max-width: 100%;
      height: auto;
      display: block;
      margin-bottom: 0.5rem;
    }

    .card code {
      display: block;
      margin: 0.5rem 0;
      font-size: 0.85rem;
      background: #f4f4f4;
      padding: 0.3rem;
    }

    @media (max-width: 768px) {
      .card {
        width: 100%;
      }
    }

    /* 애니메이션：페이드인 */
    .card {
      opacity: 0;
      transform: translateY(10px);
      animation: fadeIn 0.4s ease forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: none;
      }
    }

    /* 호버 시 부드러운 효과 */
    .card:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    /* transition 통일 */
    .card, .card:hover, button, button:hover, .file-upload-button, .file-upload-button:hover {
      transition: all 0.25s ease-in-out;
    }

     /* 선택된 파일 목록 스타일 */
    #selectedFilesList {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: #555;
    }
  </style>

</head>
<body>
  <header style="box-shadow: 0 2px 6px rgba(0,0,0,0.05); padding: 1rem 2rem; background: #fff; margin-bottom: 2rem;">
    <h1 style="margin: 0; font-size: 1.8rem; font-weight: 600; color: #333;">deeplinkmaker</h1>
  </header>
  <h2>템플릿</h2>
  <select id="templateSelect" onchange="loadTemplate()">
    <option value="">선택해주세요</option>
  </select>
  <input type="text" id="templateName" placeholder="템플릿 이름" />
  <button onclick="saveTemplate()">저장</button>
  <button onclick="deleteTemplate()">삭제</button>
  <button onclick="exportTemplates()">Export</button>
  <label for="importTemplatesFile" class="file-upload-button"> Import
  </label>
  <input type="file" id="importTemplatesFile" onchange="importTemplates(event)" /> <h2>캠페인 정보</h2>
  <button onclick="addRow()">＋ 행 추가</button>
  <table>
    <thead>
      <tr><th>Source</th><th>AppID</th><th>Campaign</th><th>Adgroup</th></tr>
    </thead>
    <tbody id="inputTable"></tbody>
  </table>

  <h2>배너 이미지 업로드</h2>
  <label for="bannerFiles" class="file-upload-button"> 이미지 선택
  </label>
  <input type="file" id="bannerFiles" multiple onchange="displaySelectedFiles()" /> <div id="selectedFilesList"></div> <div> <button onclick="generateUrls()">URL 생성</button>
    <button onclick="clearAll()">초기화</button>
    <button onclick="downloadCSV()">CSV로 다운로드</button>
  </div>

  <h2>생성 결과</h2>
  <div class="output" id="output"></div>

  <script>
    const templateKey = "deeplinkTemplates";

    function createRow(data = {}) {
      const row = document.createElement('tr');
      ['source', 'appid', 'campaign', 'adgroup'].forEach(key => {
        const td = document.createElement('td');
        const input = document.createElement('input');
        input.value = data[key] || '';
        input.setAttribute('onpaste', 'handlePaste(event)');
        td.appendChild(input);
        row.appendChild(td);
      });
      return row;
    }

    function addRow(data = {}) {
      const table = document.getElementById('inputTable');
      table.appendChild(createRow(data));
    }

    function handlePaste(e) {
      e.preventDefault();
      const text = (e.clipboardData || window.clipboardData).getData('text');
      const rows = text.split('\n').map(r => r.split('\t'));
      const startCell = e.target.closest('td');
      if (!startCell) return; // Ensure a cell was the target

      const startRow = Array.from(document.querySelectorAll('#inputTable tr')).indexOf(startCell.parentElement);
      const startCol = Array.from(startCell.parentElement.querySelectorAll('td')).indexOf(startCell); // 시작 열 인덱스 계산

      const table = document.getElementById('inputTable');

      rows.forEach((cols, i) => {
        let row = table.children[startRow + i];
        if (!row) {
          row = createRow();
          table.appendChild(row);
        }
        cols.forEach((val, j) => {
          const targetCellIndex = startCol + j; // 붙여넣을 타겟 셀의 인덱스 계산
          // Ensure the target cell exists before trying to access its child
          if (row.children[targetCellIndex]) {
             const input = row.children[targetCellIndex].firstChild;
             if (input) input.value = val.trim();
          }
        });
      });
    }

     // 선택된 파일 이름을 표시하는 함수
    function displaySelectedFiles() {
      const filesInput = document.getElementById('bannerFiles');
      const selectedFilesList = document.getElementById('selectedFilesList');
      selectedFilesList.innerHTML = ''; // 이전 목록 초기화

      const files = filesInput.files;
      if (files.length > 0) {
        const fileNames = [];
        for (let i = 0; i < files.length; i++) {
          fileNames.push(files[i].name);
        }
        selectedFilesList.textContent = '선택된 파일: ' + fileNames.join(', ');
      } else {
        selectedFilesList.textContent = ''; // 파일이 선택되지 않은 경우
      }
    }


    function generateUrls() {
      const output = document.getElementById('output');
      output.innerHTML = '';
      const rows = document.querySelectorAll('#inputTable tr');
      const files = document.getElementById('bannerFiles').files;
      const all = [];

      rows.forEach(row => {
        const [source, appid, campaign, adgroup] = Array.from(row.querySelectorAll('input')).map(i => i.value.trim());
        if (!(source && appid && campaign && adgroup)) return;

        Array.from(files).forEach(file => {
          const content = encodeURIComponent(file.name);
          const url = `https://platform-sc.g123.jp/micro-app/auxin/landing-page/deeplink.html?callback=h5.g123.jp%2Fgame%2F${appid}%3Fplatform%3Dauto%26utm_source%3D${source}%26utm_campaign%3D${campaign}%26utm_adgroup%3D${adgroup}%26lang%3Dja%26utm_content%3D${content}`;
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `
          <img src="${URL.createObjectURL(file)}" />
          <div class="info">
            <table>
              <tr><td><strong>Campaign:</strong></td><td>${campaign}</td></tr>
              <tr><td><strong>Adgroup:</strong></td><td>${adgroup}</td></tr>
              <tr><td><strong>File:</strong></td><td>${file.name}</td></tr>
            </table>
            <code>${url}</code>
            <button onclick="copyUrl('${url}')">복사</button>
          </div>`;
          output.appendChild(div);
          all.push([campaign, adgroup, file.name, url]);
        });
      });

      output.dataset.csv = JSON.stringify(all);
    }

    function copyUrl(url) {
      navigator.clipboard.writeText(url).then(() => alert('복사되었습니다'));
    }

    function clearAll() {
      document.getElementById('inputTable').innerHTML = '';
      document.getElementById('bannerFiles').value = ''; // 파일 입력 필드 초기화
      document.getElementById('selectedFilesList').innerHTML = ''; // 선택된 파일 목록 초기화
      document.getElementById('output').innerHTML = '';
      addRow();
    }

    function downloadCSV() {
      const rows = JSON.parse(document.getElementById('output').dataset.csv || '[]');
      let csv = '캠페인,애드그룹,파일이름,URL\n'; /* CSV 헤더 번역 */
      rows.forEach(r => {
        csv += r.map(v => `"${v.replace(/"/g, '""')}"`).join(',') + '\n';
      });
      const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
      const blob = new Blob([bom, csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'deeplinks.csv';
      a.click();
    }

    function saveTemplate() {
      const name = document.getElementById('templateName').value.trim();
      if (!name) return alert('템플릿 이름을 입력해주세요'); /* 알림 메시지 번역 */
      const data = [];
      document.querySelectorAll('#inputTable tr').forEach(tr => {
        const [source, appid, campaign, adgroup] = Array.from(tr.querySelectorAll('input')).map(i => i.value.trim());
        if (source && appid && campaign && adgroup) {
          data.push({ source, appid, campaign, adgroup });
        }
      });
      const templates = JSON.parse(localStorage.getItem(templateKey) || '{}');
      templates[name] = data;
      localStorage.setItem(templateKey, JSON.stringify(templates));
      populateTemplates();
    }

    function loadTemplate() {
      const name = document.getElementById('templateSelect').value;
      if (!name) return;
      const templates = JSON.parse(localStorage.getItem(templateKey) || '{}');
      const data = templates[name];
      if (!data) return;
      const tbody = document.getElementById('inputTable');
      tbody.innerHTML = '';
      data.forEach(row => addRow(row));
    }

    function deleteTemplate() {
      const name = document.getElementById('templateSelect').value;
      const templates = JSON.parse(localStorage.getItem(templateKey) || '{}');
      delete templates[name];
      localStorage.setItem(templateKey, JSON.stringify(templates));
      populateTemplates();
    }

    function exportTemplates() {
      const blob = new Blob([localStorage.getItem(templateKey)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'templates.json';
      a.click();
    }

    function importTemplates(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          localStorage.setItem(templateKey, JSON.stringify(data));
          populateTemplates();
        } catch {
          alert('잘못된 JSON 형식입니다'); /* 알림 메시지 번역 */
        }
      };
      reader.readAsText(file);
    }

    function populateTemplates() {
      const select = document.getElementById('templateSelect');
      const templates = JSON.parse(localStorage.getItem(templateKey) || '{}');
      select.innerHTML = '<option value="">선택해주세요</option>'; /* 옵션 텍스트 번역 */
      Object.keys(templates).forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      populateTemplates();
      addRow();
    });
  </script>
</body>
</html>
